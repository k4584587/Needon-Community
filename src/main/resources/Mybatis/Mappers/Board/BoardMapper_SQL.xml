<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Board">

	<!-- <select id="list" resultType="Board">
		select * from nb_board_${category} where cm_ck=0 order by no desc, register_date desc;
	</select> -->
	
	<select id="listpage" resultType="Board">
		select * from nb_board_${category} 
		<where>
		
			<if test="keyword != null and search!='subcon'">
				${search} like CONCAT ('%', #{keyword}, '%')
			</if>
			<if test="keyword != null and search=='subcon'">
				subject like CONCAT ('%', #{keyword}, '%') or
				content like CONCAT ('%', #{keyword}, '%')
			</if>
			
		</where> order by no desc, register_date desc
		limit #{pageStart}, #{perPageNum};
	</select>
	
	<select id="view" resultType="Board">
		select * from nb_board_${category} where no = #{no};
	</select>
	
	<select id="listcount" resultType="int">
		select count(no) from nb_board_${category}
		<where>
			<if test="keyword != null and search !='subcon'">
				${search} like CONCAT ('%', #{keyword}, '%')
			</if>
			<if test="keyword != null and search=='subcon'">
				subject like CONCAT ('%', #{keyword}, '%') or
				content like CONCAT ('%', #{keyword}, '%')
			</if>
		</where>;
	</select>
	
	<update id="viewcount" parameterType="int">
		update nb_board_${category} set read_count=read_count+1
		where no=#{no};
	</update>
	
	<insert id="insert">
		INSERT INTO nb_board_${category} (subject, content, file, ip,wr_nick,wr_password)
		VALUES (#{subject}, #{content}, #{file}, #{ip}, #{wr_nick},#{wr_password});
	</insert>
	
	<delete id="delete">
		DELETE FROM nb_board_${category} WHERE no = #{no};
		ALTER TABLE nb_board_notice AUTO_INCREMENT=1;	
	</delete>
	
	<update id="modify">
		update nb_board_${category} set subject=#{subject}, content=#{content}, file=#{file, jdbcType=BLOB},
		ip=#{ip, jdbcType=VARCHAR}, register_date=#{register_date} where no = #{no};
	</update>
	
	<select id="replylist" resultType="Board">
		select cm_nick, cm_no, cm_body, cm_regdate from nb_board_freeboard
		where no = #{no} order by cm_no;
	</select>
	<insert id="replyinsert" >
		<selectKey keyProperty="no" order="BEFORE" resultType="int">
			select nvl(max(cm_no),0) + 1 from nb_board_${category}
		</selectKey>
		insert into nb_board_${category} (no, cm_no, cm_body,
			cm_nick) values (#{no},#{cm_no},#{cm_body},
			#{cm_nick})
	</insert>
	<update id="replyupdate" >
		update nb_board_${category} set cm_body=#{cm_body},
			 where cm_no=#{cm_no} 
			
	</update>
	<delete id="replydelete" >
		delete from nb_board_${category} where cm_no=#{cm_no}
	</delete>

</mapper>
